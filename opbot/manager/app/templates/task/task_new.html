{% extends 'common/manu.html' %}
{% block header %}
<!-- load codemirror-5.52.0 -->
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/lib/codemirror.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/3024-day.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/3024-night.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/abcdef.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/ambiance.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/ayu-dark.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/ayu-mirage.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/base16-dark.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/bespin.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/base16-light.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/blackboard.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/cobalt.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/colorforth.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/dracula.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/duotone-dark.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/duotone-light.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/eclipse.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/elegant.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/erlang-dark.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/gruvbox-dark.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/hopscotch.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/icecoder.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/isotope.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/lesser-dark.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/liquibyte.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/lucario.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/material.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/material-darker.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/material-palenight.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/material-ocean.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/mbo.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/mdn-like.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/midnight.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/monokai.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/moxer.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/neat.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/neo.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/night.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/nord.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/oceanic-next.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/panda-syntax.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/paraiso-dark.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/paraiso-light.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/pastel-on-dark.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/railscasts.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/rubyblue.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/seti.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/shadowfox.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/solarized.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/the-matrix.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/tomorrow-night-bright.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/tomorrow-night-eighties.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/ttcn.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/twilight.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/vibrant-ink.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/xq-dark.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/xq-light.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/yeti.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/idea.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/darcula.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/yonce.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror-5.52.0/theme/zenburn.css') }}">
<script src="{{ url_for('static', filename='codemirror-5.52.0/lib/codemirror.js') }}"></script>
<script src="{{ url_for('static', filename='codemirror-5.52.0/mode/javascript/javascript.js') }}"></script>
<script src="{{ url_for('static', filename='codemirror-5.52.0/addon/selection/active-line.js') }}"></script>
<script src="{{ url_for('static', filename='codemirror-5.52.0/addon/edit/matchbrackets.js') }}"></script>
<style>
    .CodeMirror {border: 1px solid black; font-size:13px}
</style>
<!-- load jsgrid-1.5.3  -->
<link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='jsgrid-1.5.3/dist/jsgrid.min.css') }}" />
<link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='jsgrid-1.5.3/dist/jsgrid-theme.min.css') }}" />

<script type="text/javascript" src="{{ url_for('static', filename='jsgrid-1.5.3/dist/jsgrid.min.js') }}"></script>
<script src="{{ url_for('static', filename='task/task_new_db.js') }}"></script>

<script type=text/javascript>
    $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
</script>
<script type="text/javascript" src="{{ url_for('static', filename='task/task_new.js') }}"></script>
<section class="column-group article">
    <div class="xlarge-100 large-100 medium-100 small-100 tiny-100">
        <article>
            <header>
                <h1 class="push-left">태스크 등록</h1>
                <p class="push-right">OOO(xxx@xxx.com)님 환영합니다. 접속일: <time pubdate="pubdate">2009-10-09</time></p>
            </header>
        </article>
    </div>
</section>
{% endblock %}
{% block content %}
<form action="#" class="ink-form column-group gutters">
    <input type="hidden" id="task_uid" value="{% if form is defined %}{{ form.uid }}{% endif %}">
    <fieldset class="all-50 small-100 tiny-100">
        <div class="control-group required">
            <label for="type1">연동 유형</label>
            <div class="control-group">
                <ul class="control unstyled" id="type1">
                    <li>
                        <input type="radio" id="rb11" name="rb1" value="0"{% if form is defined %}
                               {% if form.task_type == 0  %}
                               checked
                               {% endif %}
                               {% else %}
                               checked
                               {% endif %}>
                        <label for="rb11">OPMATE</label>
                    </li>
                    <li>
                        <input type="radio" id="rb12" name="rb1" value="1"{% if form is defined %}
                               {% if form.task_type == 1  %}
                               checked
                               {% endif %}
                               {% endif %}>
                        <label for="rb12">K8s</label>
                    </li>
                    <li>
                        <input type="radio" id="rb13" name="rb1" value="2"{% if form is defined %}
                               {% if form.task_type == 2  %}
                               checked
                               {% endif %}
                               {% endif %}>
                        <label for="rb13">Command</label>
                    </li>
                    <li>
                        <input type="radio" id="rb14" name="rb1" value="3"{% if form is defined %}
                               {% if form.task_type == 3  %}
                               checked
                               {% endif %}
                               {% endif %}>
                        <label for="rb14">Shell Script</label>
                    </li>
                </ul>
            </div>
        </div>
    </fieldset>
    <fieldset class="all-50 small-100 tiny-100">
        <div class="control-group required">
            <label for="type2">처리 유형</label>
            <div class="control-group">
                <ul class="control unstyled" id="type2">
                    <li>
                        <input type="radio" id="rb21" name="rb2" value="A"{% if form is defined %}
                               {% if form.action_type == 'A'  %}
                               checked
                               {% endif %}
                               {% else %}
                               checked
                               {% endif %}>
                        <label for="rb21">분석</label>
                    </li>
                    <li>
                        <input type="radio" id="rb22" name="rb2" value="S"{% if form is defined %}
                               {% if form.action_type == 'S'  %}
                               checked
                               {% endif %}
                               {% endif %}>
                        <label for="rb22">조치</label>
                    </li>
                </ul>
            </div>
        </div>
    </fieldset>
    <fieldset class="all-100 small-100 tiny-100">
        <div class="control-group required column-group gutters" id="task_name_group">
            <label for="task_name" class="all-10">태스크 이름</label>
            <div class="control all-90">
                <input type="text" id="task_name" {% if form is defined %}value="{{ form.task_name }}"{% endif %}>
                <p class="tip" id="task_name_tip">&nbsp;</p>
            </div>
        </div>
        <div class="control-group required column-group gutters" id="desc_group">
            <label for="desc" class="all-10">등록 사유</label>
            <div  class="control all-90">
                <textarea id="desc">{% if form is defined %}{{ form.cause }}{% endif %}</textarea>
                <p class="tip" id="desc_tip">&nbsp;</p>
            </div>
        </div>
        <div class="control-group required gutters" id="script_group">
            <label>스크립트</label>
            <textarea id="task_script" name="task_script">{% if form is defined %}{{ form.contents }}{% endif %}</textarea>
            <p class="tip" id="script_tip">&nbsp;</p>
        </div>
        <div class="control-group push-right" id="script_theme_group">
            <p class="label">테마 선택: <select onchange="selectTheme()" id=select>
                <option selected>default</option>
                <option>3024-day</option>
                <option>3024-night</option>
                <option>abcdef</option>
                <option>ambiance</option>
                <option>ayu-dark</option>
                <option>ayu-mirage</option>
                <option>base16-dark</option>
                <option>base16-light</option>
                <option>bespin</option>
                <option>blackboard</option>
                <option>cobalt</option>
                <option>colorforth</option>
                <option>darcula</option>
                <option>dracula</option>
                <option>duotone-dark</option>
                <option>duotone-light</option>
                <option>eclipse</option>
                <option>elegant</option>
                <option>erlang-dark</option>
                <option>gruvbox-dark</option>
                <option>hopscotch</option>
                <option>icecoder</option>
                <option>idea</option>
                <option>isotope</option>
                <option>lesser-dark</option>
                <option>liquibyte</option>
                <option>lucario</option>
                <option>material</option>
                <option>material-darker</option>
                <option>material-palenight</option>
                <option>material-ocean</option>
                <option>mbo</option>
                <option>mdn-like</option>
                <option>midnight</option>
                <option>monokai</option>
                <option>moxer</option>
                <option>neat</option>
                <option>neo</option>
                <option>night</option>
                <option>nord</option>
                <option>oceanic-next</option>
                <option>panda-syntax</option>
                <option>paraiso-dark</option>
                <option>paraiso-light</option>
                <option>pastel-on-dark</option>
                <option>railscasts</option>
                <option>rubyblue</option>
                <option>seti</option>
                <option>shadowfox</option>
                <option>solarized dark</option>
                <option>solarized light</option>
                <option>the-matrix</option>
                <option>tomorrow-night-bright</option>
                <option>tomorrow-night-eighties</option>
                <option>ttcn</option>
                <option>twilight</option>
                <option>vibrant-ink</option>
                <option>xq-dark</option>
                <option>xq-light</option>
                <option>yeti</option>
                <option>yonce</option>
                <option>zenburn</option>
            </select></p>
        </div>
    </fieldset>
    <fieldset class="all-100 small-100 tiny-100">
        <div class="control-group required gutters" id="target_list_group">
            <label>스크립트 수행 목적지</label>
            <div id="targetList"></div>
        </div>
        <div class="control-group push-right">
            <button class="ink-button black" id="create">태스크 등록</button>
        </div>
    </fieldset>
    <fieldset class="all-100 small-100 tiny-100">
        <div class="control-group gutters">
        </div>
        <!-- bottom buffer -->
    </fieldset>
</form>
<script>
// 상단 메뉴 활성화.
$("#top_menu").children().eq(0).addClass('active');

// CodeMirror
var editor = CodeMirror.fromTextArea(document.getElementById("task_script"), {
    lineNumbers: true,
    styleActiveLine: true,
    matchBrackets: true
});
// check script contents
editor.on("blur", function() {
    initValidationMessage('#script_group');
    taskUid = $('#task_uid').val();
    desc = $('#desc').val();
    console.log("---task_uid=[" + taskUid + "]");

    if (taskUid.length === 0) {
        $('#script_group').addClass("validation error");
        $('#script_tip').text("태스크 이름을 확인하세요!");
    } else {
      $.ajax({
          type: 'POST',
          url: $SCRIPT_ROOT + '/task/_check_script',
          data: {
              task_uid: taskUid,
              desc: desc,
              script: editor.getValue()
          },
          dataType: 'JSON',
          success: function(data) {
              console.log(data.result);
              res = data.result;

              if (res.result === true) {
                  tip = res.detail.script.tip;
                  $('#script_tip').text(tip);
              } else {
                  c = res.detail.script.class;
                  $('#script_group').addClass(c[0]);
                  t = res.detail.script.tip;
                  $('#script_tip').text(t[0]);
              }
          },
          error: function(xtr, status, error) {
              console.log(xtr +":"+status+":"+error);
          }
      });
    }
});

var input = document.getElementById("select");

function selectTheme() {
    var theme = input.options[input.selectedIndex].textContent;
    editor.setOption("theme", theme);
    location.hash = "#" + theme;
}

var choice = (location.hash && location.hash.slice(1)) ||
             (document.location.search && decodeURIComponent(document.location.search.slice(1)));

if (choice) {
    input.value = choice;
    editor.setOption("theme", choice);
}

CodeMirror.on(window, "hashchange", function() {
    var theme = location.hash.slice(1);
    if (theme) { input.value = theme; selectTheme(); }
});
// jsGrid
$(function() {
    $("#targetList").jsGrid({
        height: "auto",
        width: "100%",
        filtering: false,
        editing: true,
        inserting: true,
        sorting: true,
        paging: true,
        autoload: true,
        pageSize: 10,
        pageButtonCount: 5,
        deleteConfirm: "해당 목적지를 삭제하시겠습니까?",
        noDataContent: "목적지 정보가 없습니다.",
        controller: db,
        fields: [
            { name: "Ip", title: "아이피(호스트명)", type: "text", width: 200, validate: "required" },
            { name: "Port", title: "포트", type: "number", width: 100, validate: "required" },
            { name: "Id", title: "아이디", type: "text", width: 150, validate: "required" },
            { name: "Password", title: "패스워드", type: "text", width: 150, validate: "required" },
            { type: "control" }
        ]
    });
});
</script>
{% endblock %}
