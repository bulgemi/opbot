{% extends 'common/manu.html' %}
{% block header %}
<link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='jsgrid-1.5.3/dist/jsgrid.min.css') }}" />
<link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='jsgrid-1.5.3/dist/jsgrid-theme.min.css') }}" />

<script type="text/javascript" src="{{ url_for('static', filename='jsgrid-1.5.3/dist/jsgrid.min.js') }}"></script>
<!-- for test -->
<script src="{{ url_for('static', filename='jsgrid-1.5.3/demos/db.js') }}"></script>

<section class="column-group article">
    <div class="xlarge-100 large-100 medium-100 small-100 tiny-100">
        <article>
            <header>
                <h1 class="push-left">태스크 관리</h1>
                <p class="push-right">OOO(xxx@xxx.com)님 환영합니다. 접속일: <time pubdate="pubdate">2009-10-09</time></p>
            </header>
        </article>
    </div>
</section>
{% endblock %}
{% block content %}
<form action="#" class="ink-form column-group gutters">
    <fieldset class="all-100 small-100 tiny-100">
        <div class="column-group horizontal-gutters push-right">
            <!-- Prepend button -->
            <div class="control-group">
                <select onchange="" id="cond1">
                    <option selected>태스크명</option>
                    <option>연동타입</option>
                    <option>처리유형</option>
                    <option>상태</option>
                </select>
            </div>
            <!-- Append button -->
            <div class="control-group">
                <div class="control append-button" role="search">
                    <span><input type="text" name="name" id="name" placeholder="Please input some text"></span>
                    <button class="ink-button black">Search</button>
                </div>
            </div>
        </div>
        <div id="taskList"></div>
    </fieldset>
    <fieldset class="all-100 small-100 tiny-100">
        <div class="control-group gutters">
        </div>
        <!-- bottom buffer -->
    </fieldset>
</form>
<script>
        $(function() {

            $("#taskList").jsGrid({
                height: "auto",
                width: "100%",
                filtering: false,
                editing: false,
                sorting: true,
                paging: true,
                autoload: true,
                pageSize: 15,
                pageButtonCount: 5,
                controller: db,
                fields: [
                    {
                        headerTemplate: function() {
                            return $("<button>").attr("type", "button").text("잠금")
                                    .on("click", function () {
                                        lockSelectedItems();
                                    });
                        },
                        itemTemplate: function(_, item) {
                            return $("<input>").attr("type", "checkbox")
                                    .prop("checked", $.inArray(item, selectedItems) > -1)
                                    .on("change", function () {
                                        $(this).is(":checked") ? selectItem(item) : unselectItem(item);
                                    });
                        },
                        align: "center",
                        width: 60
                    },
                    { name: "Name", type: "text", width: 140 },
                    { name: "Age", type: "number", width: 50 },
                    { name: "Address", type: "text", width: 200 },
                    { name: "Country", type: "select", items: db.countries, valueField: "Id", textField: "Name" },
                    { name: "Married", type: "checkbox", title: "Is Married", sorting: false },
                    { type: "control", modeSwitchButton: false, editButton: false }
                ]
            });

            var selectedItems = [];

            var selectItem = function(item) {
                selectedItems.push(item);
            };

            var unselectItem = function(item) {
                selectedItems = $.grep(selectedItems, function(i) {
                    return i !== item;
                });
            };

            var lockSelectedItems = function() {
                if(!selectedItems.length || !confirm("Are you sure?"))
                    return;

                lockClientsFromDb(selectedItems);

                var $grid = $("#userList");
                $grid.jsGrid("option", "pageIndex", 1);
                $grid.jsGrid("loadData");

                selectedItems = [];
            };

            var lockClientsFromDb = function(lockClients) {
                db = $.map(db, function(client) {
                    return ($.inArray(client, lockClients) > -1) ? null : client;
                });
            };
        });
</script>
{% endblock %}
